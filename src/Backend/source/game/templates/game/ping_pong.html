<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pong Game</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #282c34;
            color: white;
            overflow: hidden;
        }
        canvas {
            border: 2px solid white;
            background: black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // Game state
        let paddleHeight = 100, paddleWidth = 10, ballRadius = 10;
        let leftPaddleY = 150, rightPaddleY = 150, ballX = 400, ballY = 200;
        let playerSide = null; // "left" or "right"

        // Connect to WebSocket
        const socket = new WebSocket("ws://127.0.0.1:8000/ws/pingpong/");

        socket.onopen = () => {
            console.log("Connected to WebSocket");
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);

            if (data.type === "state") {
                // Update game state
                leftPaddleY = data.leftPaddleY;
                rightPaddleY = data.rightPaddleY;
                ballX = data.ballX;
                ballY = data.ballY;
            } else if (data.type === "init") {
                // Assign player side
                playerSide = data.side;
                alert(`You are playing as: ${playerSide}`);
            }
        };

        socket.onclose = () => {
            alert("Disconnected from server.");
        };

        // Send paddle movement to server
        function sendPaddleMovement(direction) {
            socket.send(JSON.stringify({ type: "move", direction }));
        }

        // Handle keyboard input
        document.addEventListener("keydown", (event) => {
            if (playerSide === "left" && (event.key === "w" || event.key === "s")) {
                sendPaddleMovement(event.key === "w" ? "up" : "down");
            } else if (playerSide === "right" && (event.key === "ArrowUp" || event.key === "ArrowDown")) {
                sendPaddleMovement(event.key === "ArrowUp" ? "up" : "down");
            }
        });

        // Draw the ball
        function drawBall() {
            ctx.beginPath();
            ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.closePath();
        }

        // Draw paddles
        function drawPaddles() {
            ctx.fillStyle = "white";
            ctx.fillRect(0, leftPaddleY, paddleWidth, paddleHeight);
            ctx.fillRect(canvas.width - paddleWidth, rightPaddleY, paddleWidth, paddleHeight);
        }

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBall();
            drawPaddles();
            requestAnimationFrame(gameLoop);
        }

        // Start the game
        gameLoop();


    </script>
</body>
</html>
